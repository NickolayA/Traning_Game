<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

    <div id="game">

        <table id="grid">
        </table>

    </div>

    <style>
        #game{
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        
        #grid{
            width: 70%;
            height: 70%;
            border-collapse: collapse;
            border-spacing: 0;
            position: relative;
            table-layout: fixed;
        }   

        #grid td{
            border: 1px solid black;
            text-align: right;
            vertical-align: top;
            position: relative;
        }
        #grid tr:nth-last-child(2) td:last-child{
            border-bottom: 0;
        }
        #grid tr:nth-last-child(1) td{
            border: none;
        }

        #grid tr:last-child td:nth-last-child(1){
            
        }
        
        #character{
            background-color: rgba(150, 150, 150, 0.2);
            position: absolute;
            z-index: 5;
            text-align: center;
            vertical-align: middle;
            border: 1xp solid red;
            width: 100%;
            height: 100%;
        }


    </style>

    <script type="text/javascript">
        var heightCountSquares = 2 + (1);
        var widthCountSquares = 2;


        var grid = "";
        for (var i = 0; i < heightCountSquares; i++) {
            grid += "<tr>";
            for (var j = 0; j < widthCountSquares; j++) {
                grid += "<td>" + 10 + "</td>";
            }
            grid += "</tr>";
        }

        document.getElementById("grid").innerHTML = grid;

        // // Grid class constructor
        // function Grid(name) {
        //     this.name = name;
        // }
        // Grid.prototype.createGrid = function () {
        //     return this.name;
        // }

        // var grid = new Grid("JOhn");
        // console.log(grid.createGrid());

        var game = document.getElementById("game");

        var characterClass = {
            width: 0.7 * game.offsetWidth / widthCountSquares,
            height: 0.7 * game.offsetHeight / heightCountSquares,
            createCharacter: function () {
                var character = document.createElement('div');
                character.setAttribute("id", "character");
                character.style.width = "100%";
                character.style.height = "100%";
                character.style.top = "0px";
                character.style.left = "0px";
                character.innerText = 0;

                return character;
            }
        };

        function Character(startPositionX, startPositionY) {
            this.positionX = startPositionX;
            this.positionY = startPositionY;
        }

        Character.prototype.createCharacter = function () {

        }

        var grid = document.getElementById("grid");
        var character = characterClass.createCharacter();
        var tds = grid.getElementsByTagName('td');
        //tds[widthCountSquares * (heightCountSquares + 1) - 1].appendChild(character);

        var currentPositionX = widthCountSquares - 1;
        var currentPositionY = heightCountSquares - 1;
        tds[currentPositionY * widthCountSquares + currentPositionX].appendChild(character);



        document.onkeydown = function (e) {

            switch (e.keyCode) {
                case 37:
                    if (currentPositionX != 0 && currentPositionY !=
                        heightCountSquares + 1 && currentPositionY != heightCountSquares - 1) {
                        character.parentNode.removeChild(character);
                        currentPositionX -= 1;
                        tds[currentPositionY * widthCountSquares + currentPositionX].appendChild(character);
                    }

                    // var leftDistance = parseFloat(parseFloat(character.style.right).toFixed(2)) + parseFloat(
                    //     parseFloat(
                    //         character.style.width)
                    //     .toFixed(2));
                    // console.log(leftDistance);
                    // // refractoring double parseFloat
                    // if (leftDistance < parseFloat(character.style.width) * widthCountSquares && parseFloat(
                    //         character.style.bottom) >= 0) {
                    //     character.style.right = leftDistance +
                    //         "px";
                    // }
                    break;
                case 38:
                    if (currentPositionY != 0) {
                        character.parentNode.removeChild(character);
                        currentPositionY -= 1;
                        tds[currentPositionY * widthCountSquares + currentPositionX].appendChild(character);
                    }
                    // var upDistance = parseFloat(parseFloat(character.style.bottom).toFixed(1)) + parseFloat(
                    //     parseFloat(
                    //         character.style.height).toFixed(1));
                    // console.log(upDistance);
                    // if (upDistance <= parseFloat(character.style.height) * heightCountSquares) {
                    //     character.style.bottom = upDistance +
                    //         "px";
                    // }
                    break;
                case 39:
                    if (currentPositionX != widthCountSquares - 1) {
                        character.parentNode.removeChild(character);
                        currentPositionX += 1;
                        tds[currentPositionY * widthCountSquares + currentPositionX].appendChild(character);
                    }
                    // var rightDistance = parseFloat(character.style.right) - parseFloat(character.style.width);

                    // console.log(rightDistance);
                    // if (rightDistance >= 0) {
                    //     character.style.right = rightDistance +
                    //         "px";
                    // }
                    break;
                case 40:
                    if (currentPositionY != heightCountSquares - 1 && currentPositionX == widthCountSquares - 1) {
                        character.parentNode.removeChild(character);
                        currentPositionY += 1;
                        tds[currentPositionY * widthCountSquares + currentPositionX].appendChild(character);
                    } else if (currentPositionY != heightCountSquares - 2 && currentPositionX != widthCountSquares -
                        1) {
                        character.parentNode.removeChild(character);
                        currentPositionY += 1;
                        tds[currentPositionY * widthCountSquares + currentPositionX].appendChild(character);
                    }
                    // var bottomDistance = parseFloat(character.style.bottom) - parseFloat(character.style.height);
                    // console.log(bottomDistance);
                    // console.log(character.style.right);
                    // if (bottomDistance <= 0 && parseFloat(character.style.right) === 0 && bottomDistance <=
                    //     bottomDistance + parseFloat(character.style.bottom)) {
                    //     character.style.bottom = bottomDistance + "px";
                    // } else if (bottomDistance < bottomDistance + parseFloat(character.style.bottom)) {
                    //     character.style.bottom = bottomDistance +
                    //         "px";
                    // }
                    break;
                case 32:
                    var positionIndex = currentPositionY * widthCountSquares + currentPositionX;

                    if (positionIndex == widthCountSquares * heightCountSquares - 1) {
                        // On Exit position
                        var countOfBoxes = parseInt(character.innerHTML);
                        if (countOfBoxes != 0) {
                            tds[positionIndex].innerText = parseInt(tds[positionIndex].innerHTML) + 1;
                            tds[positionIndex].appendChild(character);
                            character.innerText = parseInt(character.innerText) - 1;
                        }
                    } else {
                        // In storages
                        var countOfBoxes = parseInt(tds[positionIndex].innerHTML);
                        if (countOfBoxes != 0) {
                            tds[positionIndex].innerText = countOfBoxes - 1;
                            tds[positionIndex].appendChild(character);
                            character.innerText = parseInt(character.innerText) + 1;
                        }
                    }
                    // var rowIndex = heightCountSquares - parseFloat(character.style.bottom) / parseFloat(character.style
                    //     .height) - 1;
                    // var columnIndex = widthCountSquares - parseFloat(
                    //     character.style
                    //     .right) / parseFloat(character.style.width) - 1;
                    // if (rowIndex < heightCountSquares) {
                    //     var rightIndex = Math.round(rowIndex * widthCountSquares + columnIndex);
                    //     var storage = document.getElementsByTagName('td')[rightIndex];
                    //     var currentNumberOfBoxes = parseFloat(storage.innerText);
                    //     if (currentNumberOfBoxes > 0) {
                    //         storage.innerHTML = currentNumberOfBoxes - 1;
                    //         character.innerText = parseFloat(character.innerText) + 1;
                    //     }

                    // } else if (parseFloat(character.innerText) > 0) {
                    //     character.innerText = parseFloat(character.innerText) - 1;
                    // }
                    //console.log(document.getElementsByTagName("td")[rowIndex * heightCountSquares + columnIndex].innerText)

            }
        }
    </script>
</body>

</html>